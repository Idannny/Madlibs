{% extends "base.html" %}

{% block title %}Ad-Lib Game AI Generated :3 {% endblock %}

{% block content %}

<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
<h1>Ad-Lib Game with ChatGPT</h1>

{% if 'user' not in session %}
    {% if session.get('usage_count', 0) < 3 %}
        <p>You have {{ 3 - session.get('usage_count', 0) }} free tries remaining. Sign in for unlimited use.</p>
    {% else %}
        <p>You have used all your free tries. Please <a href="{{ url_for('login') }}">sign in</a> to continue.</p>
    {% endif %}
{% endif %}

{% if error %}
    <p class="error">{{ error }}</p>
{% endif %}


<form action="{{ url_for('submit') }}" method="post">
    <label for="artstyle">Image Art Style:</label>
    <select id="artstyle" name="artstyle">
        <option value="abstract">Abstract</option>
        <option value="realism">Realism</option>
        <option value="impressionism">Impressionism</option>
        <option value="cubism">Cubism</option>
        <option value="Cartoon">Cartoon</option>
        <option value="Gothic">Gothic</option>
        <option value="StickFigure">Stick Figure</option>
        <!-- Add more options as needed -->
    </select><br>

    <label for="noun">Noun:</label>
    <input type="text" id="noun" name="noun" required><br>

    <label for="verb">Verb:</label>
    <input type="text" id="verb" name="verb" required><br>

    <label for="adjective">Adjective:</label>
    <input type="text" id="adjective" name="adjective" required><br>

    <label for="adverb">Adverb:</label>
    <input type="text" id="adverb" name="adverb" required><br>

    <label for="number">Number:</label>
    <input type="number" id="number" name="number" required><br>

    <label for="bodypart">Body Part:</label>
    <input type="text" id="bodypart" name="bodypart" required><br>
    
    <!-- <div class="g-recaptcha" data-sitekey="6Ldnna0qAAAAAGiHhXtBzHyZl3Ew-JIgtCT9DH-f"></div> -->
  
    <button type="submit" class="btn-submit">Submit</button>
</form>

<div id="result" style="display: none;">
    <h2>Your Ad-Lib Story:</h2>
    <p id="story"></p>
    <img id="image" src="" alt="DALL-E Image">
</div>


{% if story %}
    <h2>Your Ad-Lib Story:</h2>
    <p>{{ story }}</p>
{% endif %}

{% if image %}
    <img src="{{ image }}" alt="DALL-E Image">
{% endif %}

<form action="/create-checkout-session" method="POST">
    <button type="submit" id="checkout-button">Checkout</button>
</form>

<script src="https://js.stripe.com/v3/"></script>
<script>
    var stripe = Stripe('pk_live_51Nv7YjIZXlMiQ2QllnDGTIcgdhCpJ2K5zbtv4W2xV4NLPhkQVQwVjyCT5VSP79Ev167UoLaRJx9IyHn0bDQWhdEA00wsOS91mg');
    var checkoutButton = document.getElementById('checkout-button');

    checkoutButton.addEventListener('click', function (e) {
        e.preventDefault();
        fetch('/create-checkout-session', {
            method: 'POST',
        })
        .then(function (response) {
            return response.json();
        })
        .then(function (sessionId) {
            return stripe.redirectToCheckout({ sessionId: sessionId.id });
        })
        .then(function (result) {
            if (result.error) {
                alert(result.error.message);
            }
        })
        .catch(function (error) {
            console.error('Error:', error);
        });
    });
</script>

 
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('form');
    const loadingScreen = document.getElementById('loading-screen');
    const resultDiv = document.getElementById('result');

    form.addEventListener('submit', function(e) {
        e.preventDefault();
        loadingScreen.style.display = 'flex';
        resultDiv.style.display = 'none';

        let formData = new FormData(form);
        
        // formData.append('g-recaptcha-response', grecaptcha.getResponse());
    

        fetch('{{ url_for("submit") }}', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
	    
	    console.log("Recieved Data", data)	
            
	    loadingScreen.style.display = 'none';
            //grecaptcha.reset();
            if (data.error) {
                console.log("data error",data.error  )
		alert(data.error);
            } else {
                // Update the page with the story and image
                document.querySelector('#story').textContent = data.story;
                document.querySelector('#image').src = data.image;
                resultDiv.style.display = 'block';
            }
        })
        .catch(error => {
            loadingScreen.style.display = 'none';
            console.error('Error:', error);
            alert('An error occurred. Please try again.');
        });
    });
});
</script>
 
{% endblock %}
